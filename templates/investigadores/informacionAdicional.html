{% load name %}

<div class="card" id="numeral">
    {% for numeral in numeralName %}
    <div class="card-header">

        <div data-toggle="collapse" data-target="#numeral{{numeral.id}}" onclick="icono({{numeral.id}})">
            <span class="text-primary" style="cursor: pointer;">{{numeral}}&nbsp;<i
                    class="fa fa-chevron-down numeral{{numeral.id}}"></i></span>
            <i onclick="glosario()" style="font-size: 30px; cursor: pointer;" data-toggle="modal"
                class="far fa-question-circle float-right"></i>
        </div>
    </div>

    <div id="numeral{{numeral.id}}" class="collapse" data-parent="#numeral">

            <!--modelo 14 numeral 61-->
            {% if numeral.orden == 61 %}
            <table class="table text-center" style="font-size: 14px;">
                <thead class="thead-light">
                    <tr>
                        <th>Telescopio, instrumento, infraestructura</th>
                        <th>URL:</th>
                        <th>Descripción:</th>
                        <th>Anexo</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
            
                    {% for modelo14 in numeral_61 %}
                    <tr>
                        <td>{{modelo14.TelescopioInstrumentoInfra}}</td>
                        <td>{{modelo14.url}}</td>
                        <td>{{modelo14.descripcion}}</td>
                        <td>{{modelo14.anexos.name|nombreFile}}</td>
                        <td><button onclick="" class="btn btn-success">Editar</button>
                            <button onclick="" class="btn btn-danger">Eliminar</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
            <!--Fin Numeral 61 Modelo14-->
    </div>
    {% endfor %}
</div>
{% block JsCode %}

<script>

    function glosario() {
        $("#accionModal2").text("Glosario");
        $("#textoModal2").html(`<table class="table table-bordered">
                        <thead>
                            <tr>
                                <th class="text-center" colspan="2">V. INFORMACIÓN ADICIONAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for glosario in glosario %}
                            <tr>
                                <td width=50%>{{ glosario.numerales|safe }}</td>
                                <td width=50%>{{ glosario.explicacion|safe }}</td>
                            </tr>
                            {% endfor %}

                        </tbody>
                    </table>`) //¿Desea eliminar este Item?
        $("#icono2").html("")
        $("#footer2").html(`<button type="button" class="btn btn-danger btn-block" data-dismiss="modal">Cerrar</button>`)
        $('#modalDinamico2').modal('show'); // abrir
    }
    //Modelo 14
    var Modelo14 = {
        editar: function (modelo, activar = true,) {

            var form = $('form#'+modelo).find('input, textarea');

            if (activar) {
                $.each(form, function (indexInArray, valueOfElement) {
                    $(valueOfElement).prop('disabled', false);
                });
            }
            else {
                $.each(form, function (indexInArray, valueOfElement) {
                    $(valueOfElement).prop('disabled', true);
                });
            }
            timer.reset(540000);
        },
        actualizar: function (id) {

            var formData = new FormData(document.getElementById("modelo14" + id))
            formData.append("id", id);
            
            $.ajax({
                url: '{% url "investigadores:actualizar-modelo14" %}',
                type: "post",
                data: formData,
                enctype: "multipart/form-data",
                cache: false,
                contentType: false,
                processData: false,
                dataType: 'html',
            })
                .done(function (response) {
                    Modelo14.editar('modelo14'+id, false);
                    notificacion.actualizado();
                    timer.reset(540000);
                })
                .fail(function (response) {
                    notificacion.error(response);
                });
        },
        crear: function (numeral, periodo) {
            $.ajax({
                type: "GET",
                url: '{% url "investigadores:crear-modelo14" %}',
                data: {
                    "numeral": numeral,
                    "periodo": periodo,
                },
                dataType: "Json",
            })
                .done(function (response) {
                    $("#sinEntradas" + numeral).remove()
                    $("#modelo14Crear" + numeral).after(`
                <button onclick="Modelo14.Crear(${numeral},${periodo})" type="button"
                    id="modelo14Crear${numeral}" class="btn btn-danger">
                    <i class="fas fa-plus-circle"></i>Agregar entrada</button>
                `)
                    $("#modelo14Crear" + numeral).remove()
                    Modelo14.dibujar(response);
                    timer.reset(540000);
                })
                .fail(function (response) {
                    notificacion.error(response);
                });
        },
        dibujar: function (data) {
            $("#modelo14Crear" + `${data.numeral}`).before(
                `<form id="modelo14${data.id}" type="post" enctype="multipart/form-data">
                    <div class="pt-4 pr-4 pl-4">
                        {% csrf_token %}
                        <div class="form-group row">
                            <label for="telescopio" class="col-sm-2 col-form-label">Telescopio, instrumento,
                                infraestructura:</label>
                            <div class="col-sm-10">
                                <input class="form-control mb-1" type="text" name="telescopio" id="telescopioModelo14${data.id}">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="" class="col-sm-2 col-form-label">URL: </label>
                            <div class="col-sm-10">
                                <input class="form-control mb-1" type="text" name="url" id="urlModelo14${data.id}">
                            </div>
                        </div>

                        <label for="">Descripción: </label>
                        <textarea class="form-control mb-1" name="descripcion" id="descripcionModelo14${data.id}" cols="30" rows="5"></textarea>

                        <input class="form-control" type="file" name="anexo" id="anexoModelo14${data.id}">
                        <small class="mb-4">Tamaño máximo: 5 Mb</small>

                        <div class="justify-content-end d-flex">
                            <div class="row">
                                <div class="col-12">
                                    <button onclick="Modelo14.actualizar(${data.id})" type="button" class="btn btn-success"title="Guardar cambios">
                                        <i class="fas fa-save">&nbsp;Guardar</i>
                                    </button>

                                    <button onclick="Modelo14.editar('modelo14${data.id}',false)" class="btn btn-warning text-white" type="reset">
                                        <i class="fas fa-ban text-white">&nbsp;Cancelar</i>
                                    </button>

                                    <button type="button" class="btn btn-primary" onclick="Modelo14.editar('modelo14${data.id}')" title="Editar entrada">
                                        <i class="fas fa-edit">&nbsp;Editar</i>
                                    </button>

                                    <button type="button" class="btn btn-danger" onclick="Modelo14.eliminar(${data.id})" title="Eliminar entrada">
                                        <i class="fas fa-trash-alt">&nbsp;Eliminar</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <hr>`);
        },
        eliminar: function (id) {
            notificacion.eliminar(function () {
                var csrfmiddlewaretoken = $('input[name="csrfmiddlewaretoken"]').val().trim();
                $.ajax({
                    url: '{% url "investigadores:eliminar-modelo14" %}',
                    type: "POST",
                    data: {
                        'id': id,
                        'csrfmiddlewaretoken': csrfmiddlewaretoken,
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.deleted) {

                        }
                    }
                })
                    .done(function (response) {
                        $("#modelo14" + id).remove();
                        $("#modelo14Crear" + id).remove();
                        timer.reset(540000);
                    })
                    .fail(function (response) {
                        notificacion.error(response);
                    });
            });
        },
        infoAnterior: function (periodo, numeral) {

            $.ajax({
                type: "GET",
                url: "{% url 'investigadores:info-anteriorModelo14' %}",
                data: {
                    'periodo': periodo,
                    'numeral': numeral,
                },
                dataType: "json",
            })
                .done(function (response) {
                    $('#sinEntradas' + numeral).remove()
                    for (var i = 0; i < response.descripcion.length; i++) {
                        data = {}
                        data['numeral'] = numeral;
                        data['id'] = response.ids[i];

                        dibujarmodelo14(data)
                        $("#telescopioModelo14" + response.ids[i]).val(response.telescopio[i]);
                        $("#urlModelo14" + response.ids[i]).val(response.urls[i]);
                        $("#descripcionModelo14" + response.ids[i]).val(response.descripcion[i]);
                    }

                    $("#infoAnteriorModelo14" + numeral).prop('disabled', 'true');
                    timer.reset(540000);
                })
                .fail(function (response) {
                    notificacion.error(response);
                });
        }
    }
    //Fin modelo14
</script>
{% endblock %}