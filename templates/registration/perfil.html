{% extends 'core/base.html' %}
{% load static %}

{%block contenido%}
<div class="container" style="margin-top: 150px;">

  <form action="" id="infoPersonal">
    {% csrf_token %}
    <fieldset>
      <legend>Información Personal:
        <button type="button" class="btn btn-primary float-right" id="informacionPersonal-btn"><i
            class="fas fa-edit">&nbsp;Editar</i></button>
      </legend>

      <p>Correo: <span class="text-muted">{{perfil.email}}</span></p>

      <div class="form-group">
        <label for="nombre">Nombre(s): </label>
        <input disabled type="text" class="form-control" value="{{perfil.nombre}}" name="nombres" id="nombreP">
      </div>

      <div class="form-group">
        <label for="apellido">Apellido(s): </label>
        <input disabled type="text" class="form-control" value="{{perfil.apellido}}" name="apellidos" id="apellidosP">
      </div>

      <div class="row">
        <div class="col-5 col-sm-6">
          <p>Si desea cambiar su contraseña, click <a href="{% url 'password_change' %}">aquí.</a></p>
        </div>
        <div class="col-7 col-sm-6">
          <div class="input-group justify-content-end">
            <button id="cancelarInfoPersonal" class="btn btn-warning mr-2 text-white" type="reset">
              <i class="fas fa-ban text-white"></i>&nbsp;Cancelar</i>
            </button>
            <button disabled id="infoPersonal-btn" onclick="actualizarInfoPersonal()" type="button"
              class="btn btn-success float-right"><i class="fas fa-save">&nbsp; Guardar</i>
            </button>

          </div>

        </div>
      </div>


    </fieldset>
  </form>

  <hr>
  <form action="" id="infoAcademica">
    {% csrf_token %}
    <fieldset>
      <legend>Información Académica:
        <button type="button" class="btn btn-primary float-right " id="informacionAcademica-btn"><i
            class="fas fa-edit">&nbsp;Editar</i></button>
      </legend>
      <div class="form-group">

        <label for="">Categoría:</label>
        <select disabled class="form-control mb-2" name="categoria" id="categoria">
          <option selected value="{{ perfil.categoria }}">
            {% if perfil.categoria %}{{perfil.categoria}}{% else %}Sin especificar{%endif%}
          </option>
          <option value="Investigador posdoctoral">Investigador posdoctoral</option>
          <option value="Cátedra CONACyT">Cátedra CONACyT</option>
          <option value="Investigador Asociado C">Investigador Asociado C</option>
          <option value="Investigador Titular A">Investigador Titular A</option>
          <option value="Investigador Titular B">Investigador Titular B</option>
          <option value="Investigador Titular C">Investigador Titular C</option>
          <option value="Investigador Titular D">Investigador Titular D</option>
        </select>

        <label for="">Nivel SNI:</label>
        <select disabled class="form-control mb-2" name="nivel_sni" id="nivel_sni">
          <option selected value="{{perfil.nivelSni}}">{% if perfil.nivelSni %}{{perfil.nivelSni}}{% else %}Sin
            Nombramiento{% endif %}</option>
          <option value="Candidato">Candidato</option>
          <option value="Nivel 1">Nivel 1</option>
          <option value="Nivel 2">Nivel 2</option>
          <option value="Nivel 3">Nivel 3</option>
          <option value="Emérito">Emérito</option>
        </select>

        <label for="ORCID">ORCID</label>
        <input disabled type="text" class="form-control mb-2" placeholder="Ingrese su ORCID en formato 0000-1111-2222-3333"
          value="{% if perfil.orcId %}{{perfil.orcId}}{% endif %}" name="orc_id" id="orc_id">

        <label for="">ArXiv ID</label>
        <input disabled type="text" class="form-control mb-2" placeholder="Escriba su ArXiv ID"
          value="{% if perfil.arxivId %}{{perfil.arxivId}}{% endif %}" name="arxiv_id" id="arxiv_id">

        <div class="input-group justify-content-end mt-3">

          <button id="cancelarInfoAcademica" class="btn btn-warning mr-2 text-white" type="reset">
            <i class="fas fa-ban text-white"></i>&nbsp;Cancelar</i>
          </button>

          <button disabled id="infoAcademica-btn" onclick="actualizarInfoAcademica()" type="button"
            class="btn btn-success"><i class="fas fa-save">
              &nbsp; Guardar</i></button>
        </div>
      </div>
    </fieldset>

  </form>

</div>
<div class="w-100 pt-4"></div>
{%endblock%}


{% block JSCode %}
<script>

  $(document).ready(function () {

    $("#cancelarInfoPersonal").click(function () {
      $("#nombreP").prop("disabled", true);
      $("#apellidosP").prop("disabled", true);
      $("#infoPersonal-btn").prop("disabled", true);
    });

    $("#cancelarInfoAcademica").click(function () {
      $("#categoria").prop("disabled", true);
      $("#nivel_sni").prop("disabled", true);
      $("#orc_id").prop("disabled", true);
      $("#arxiv_id").prop("disabled", true);
      $("#infoAcademica-btn").prop("disabled", true);
    })

    $("#informacionPersonal-btn").click(function () {
      $("#nombreP").prop("disabled", false);
      $("#apellidosP").prop("disabled", false);
      $("#infoPersonal-btn").prop("disabled", false);
      $(this).prop("disabled", true);
    });

    $("#infoPersonal-btn").click(function () {
      $("#nombreP").prop("disabled", true);
      $("#apellidosP").prop("disabled", true);
      $("#infoPersonal-btn").prop("disabled", true);
      $(this).prop("disabled", true);
    });

    $("#informacionAcademica-btn").click(function () {
      $("#categoria").prop("disabled", false);
      $("#nivel_sni").prop("disabled", false);
      $("#orc_id").prop("disabled", false);
      $("#arxiv_id").prop("disabled", false);
      $("#infoAcademica-btn").prop("disabled", false);
      $(this).prop("disabled", true);
    });

    $("#infoAcademica-btn").click(function () {
      $("#categoria").prop("disabled", true);
      $("#nivel_sni").prop("disabled", true);
      $("#orc_id").prop("disabled", true);
      $("#arxiv_id").prop("disabled", true);
      $("#informacionAcademica-btn").prop("disabled",false)
      $(this).prop("disabled", true);
    });

    $("#editarPerfilAdm").click(function () {
      $('#correoAlternativo').prop('disabled', false);
      $('#guardar').prop('disabled', false);
      $(this).prop("disabled", true);
    });

    $("#guardar").click(function () {
      $('#correoAlternativo').prop('disabled', true);
      $('#editarPerfilAdm').prop('disabled', false);
      $(this).prop("disabled", true);
    });
  });


  function actualizarInfoPersonal() {
    var formData = new FormData(document.getElementById("infoPersonal"));

    $.ajax({
      type: 'POST',
      url: "{% url 'registration:actualizar-perfil' %}",
      data: formData,
      enctype: "multipart/form-data",
      cache: false,
      contentType: false,
      processData: false,
      dataType: "html",
    })
      .done(function () {
        perfil.actualizado("informacion personal actualizada.");
      })
      .fail(function (message) {
        perfil.fallido(message);
      });
    return false;
  }

  function actualizarInfoAcademica() {
    var formData = new FormData(document.getElementById("infoAcademica"));

    $.ajax({
      type: 'POST',
      url: "{% url 'registration:actualizar-perfil' %}",
      data: formData,
      enctype: "multipart/form-data",
      cache: false,
      contentType: false,
      processData: false,
      dataType: "html",
    })
      .done(function () {
        perfil.actualizado("Informacion academica actualizada.")
      })
      .fail(function (message) {
        perfil.fallido(message)
      });
    return false;
  }

  var perfil = {
    actualizado: texto => {
      Swal.fire({
        title: 'Actualizado',
        text: texto,
        icon: 'success',
        showConfirmButton: false,
        timerProgressBar: true,
        timer: 2000
      });
    },
    fallido: message => {
      Swal.fire({
        title: 'Error en la solicitud',
        text: 'Algo salio mal ' + message.statusText,
        icon: 'error',
      });
    }
  }

</script>
{% endblock %}